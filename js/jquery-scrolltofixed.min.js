!function(a){a.isScrollToFixed=function(b){return!!a(b).data("ScrollToFixed")},a.ScrollToFixed=function(b,c){function r(){f.trigger("preUnfixed.ScrollToFixed"),y(),f.trigger("unfixed.ScrollToFixed"),n=-1,k=f.offset().top,l=f.offset().left,d.options.offsets&&(l+=f.offset().left-f.position().left),m==-1&&(m=l),g=f.css("position"),e=!0,d.options.bottom!=-1&&(f.trigger("preFixed.ScrollToFixed"),w(),f.trigger("fixed.ScrollToFixed"))}function s(){var a=d.options.limit;return a?"function"==typeof a?a.apply(f):a:0}function t(){return"fixed"===g}function u(){return"absolute"===g}function v(){return!(t()||u())}function w(){t()||(o.css({display:f.css("display"),width:f.outerWidth(!0),height:f.outerHeight(!0),float:f.css("float")}),cssOptions={"z-index":d.options.zIndex,position:"fixed",top:d.options.bottom==-1?A():"",bottom:d.options.bottom==-1?"":d.options.bottom,"margin-left":"0px"},d.options.dontSetWidth||(cssOptions.width=f.width()),f.css(cssOptions),f.addClass(d.options.baseClassName),d.options.className&&f.addClass(d.options.className),g="fixed")}function x(){var a=s(),b=l;d.options.removeOffsets&&(b="",a-=k),cssOptions={position:"absolute",top:a,left:b,"margin-left":"0px",bottom:""},d.options.dontSetWidth||(cssOptions.width=f.width()),f.css(cssOptions),g="absolute"}function y(){v()||(n=-1,o.css("display","none"),f.css({"z-index":j,width:"",position:h,left:"",top:i,"margin-left":""}),f.removeClass("scroll-to-fixed-fixed"),d.options.className&&f.removeClass(d.options.className),g=null)}function z(a){a!=n&&(f.css("left",l-a),n=a)}function A(){var a=d.options.marginTop;return a?"function"==typeof a?a.apply(f):a:0}function B(){if(a.isScrollToFixed(f)){var b=e;e?v()&&(k=f.offset().top,l=f.offset().left):r();var c=a(window).scrollLeft(),g=a(window).scrollTop(),i=s();d.options.minWidth&&a(window).width()<d.options.minWidth?v()&&b||(D(),f.trigger("preUnfixed.ScrollToFixed"),y(),f.trigger("unfixed.ScrollToFixed")):d.options.maxWidth&&a(window).width()>d.options.maxWidth?v()&&b||(D(),f.trigger("preUnfixed.ScrollToFixed"),y(),f.trigger("unfixed.ScrollToFixed")):d.options.bottom==-1?i>0&&g>=i-A()?u()&&b||(D(),f.trigger("preAbsolute.ScrollToFixed"),x(),f.trigger("unfixed.ScrollToFixed")):g>=k-A()?(t()&&b||(D(),f.trigger("preFixed.ScrollToFixed"),w(),n=-1,f.trigger("fixed.ScrollToFixed")),z(c)):v()&&b||(D(),f.trigger("preUnfixed.ScrollToFixed"),y(),f.trigger("unfixed.ScrollToFixed")):i>0?g+a(window).height()-f.outerHeight(!0)>=i-(A()||-C())?t()&&(D(),f.trigger("preUnfixed.ScrollToFixed"),"absolute"===h?x():y(),f.trigger("unfixed.ScrollToFixed")):(t()||(D(),f.trigger("preFixed.ScrollToFixed"),w()),z(c),f.trigger("fixed.ScrollToFixed")):z(c)}}function C(){return d.options.bottom?d.options.bottom:0}function D(){var a=f.css("position");"absolute"==a?f.trigger("postAbsolute.ScrollToFixed"):"fixed"==a?f.trigger("postFixed.ScrollToFixed"):f.trigger("postUnfixed.ScrollToFixed")}var d=this;d.$el=a(b),d.el=b,d.$el.data("ScrollToFixed",d);var g,h,i,j,e=!1,f=d.$el,k=0,l=0,m=-1,n=-1,o=null,E=function(a){f.is(":visible")&&(e=!1,B())},F=function(a){window.requestAnimationFrame?requestAnimationFrame(B):B()},H=function(a){a=a||window.event,a.preventDefault&&a.preventDefault(),a.returnValue=!1};d.init=function(){d.options=a.extend({},a.ScrollToFixed.defaultOptions,c),j=f.css("z-index"),d.$el.css("z-index",d.options.zIndex),o=a("<div />"),g=f.css("position"),h=f.css("position"),i=f.css("top"),v()&&d.$el.after(o),a(window).bind("resize.ScrollToFixed",E),a(window).bind("scroll.ScrollToFixed",F),"ontouchmove"in window&&a(window).bind("touchmove.ScrollToFixed",B),d.options.preFixed&&f.bind("preFixed.ScrollToFixed",d.options.preFixed),d.options.postFixed&&f.bind("postFixed.ScrollToFixed",d.options.postFixed),d.options.preUnfixed&&f.bind("preUnfixed.ScrollToFixed",d.options.preUnfixed),d.options.postUnfixed&&f.bind("postUnfixed.ScrollToFixed",d.options.postUnfixed),d.options.preAbsolute&&f.bind("preAbsolute.ScrollToFixed",d.options.preAbsolute),d.options.postAbsolute&&f.bind("postAbsolute.ScrollToFixed",d.options.postAbsolute),d.options.fixed&&f.bind("fixed.ScrollToFixed",d.options.fixed),d.options.unfixed&&f.bind("unfixed.ScrollToFixed",d.options.unfixed),d.options.spacerClass&&o.addClass(d.options.spacerClass),f.bind("resize.ScrollToFixed",function(){o.height(f.height())}),f.bind("scroll.ScrollToFixed",function(){f.trigger("preUnfixed.ScrollToFixed"),y(),f.trigger("unfixed.ScrollToFixed"),B()}),f.bind("detach.ScrollToFixed",function(b){H(b),f.trigger("preUnfixed.ScrollToFixed"),y(),f.trigger("unfixed.ScrollToFixed"),a(window).unbind("resize.ScrollToFixed",E),a(window).unbind("scroll.ScrollToFixed",F),f.unbind(".ScrollToFixed"),o.remove(),d.$el.removeData("ScrollToFixed")}),E()},d.init()},a.ScrollToFixed.defaultOptions={marginTop:0,limit:0,bottom:-1,zIndex:1e3,baseClassName:"scroll-to-fixed-fixed"},a.fn.scrollToFixed=function(b){return this.each(function(){new a.ScrollToFixed(this,b)})}}(jQuery);